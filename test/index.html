<!DOCTYPE html>
<html lang="en" data-theme="dark">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Schematic Renderer Pro</title>

		<script type="module" src="./main.ts"></script>
		<!-- Alpine.js -->
		<script
			defer
			src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
		></script>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>

		<!-- DaisyUI -->
		<link
			href="https://cdn.jsdelivr.net/npm/daisyui@3.1.6/dist/full.css"
			rel="stylesheet"
			type="text/css"
		/>

		<!-- Heroicons -->
		<script src="https://unpkg.com/heroicons@1.0.6/dist/outline.js"></script>

		<!-- Custom Styles -->
		<style>
			/* Custom Styles */
			.canvas-container {
				position: relative;
				width: 100%;
				max-width: 2400px;
				height: 80vh;
				margin: auto;
				background-color: #1f2937; /* Tailwind's gray-800 */
				border-radius: 0.5rem;
				box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
			}
			#canvas {
				width: 100%;
				height: 100%;
				display: block;
				border-radius: 0.5rem;
			}
			.overlay {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				pointer-events: none;
			}
			.overlay > * {
				pointer-events: auto;
			}
			/* Menu Bar */
			.menu-bar {
				background-color: rgba(
					31,
					41,
					55,
					0.9
				); /* Tailwind's gray-800 with opacity */
				backdrop-filter: blur(10px);
			}
			/* Floating Toolbar */
			.floating-toolbar {
				background-color: rgba(31, 41, 55, 0.9);
				backdrop-filter: blur(10px);
				padding: 0.5rem;
				border-radius: 0.5rem;
			}
			/* Status Cards */
			.status-card {
				background-color: rgba(31, 41, 55, 0.9);
				backdrop-filter: blur(10px);
				padding: 0.5rem 1rem;
				border-radius: 0.5rem;
			}
			/* Buttons */
			.menu-btn,
			.toolbar-btn {
				@apply btn btn-sm btn-ghost text-white;
			}
			.menu-btn:hover,
			.toolbar-btn:hover {
				@apply bg-gray-700;
			}
			/* Dropdown */
			.dropdown-content {
				backdrop-filter: blur(5px);
			}
		</style>
	</head>
	<body
		class="bg-gray-900 flex items-center justify-center min-h-screen p-4"
		x-data="rendererUI()"
		x-init="init()"
	>
		<div class="canvas-container relative">
			<canvas id="canvas"></canvas>

			<div class="overlay flex flex-col h-full">
				<!-- Menu Bar -->
				<div
					class="menu-bar flex items-center justify-between p-2 h-12 text-sm"
				>
					<div class="flex items-center space-x-4">
						<!-- View Dropdown -->
						<div class="dropdown dropdown-hover">
							<label tabindex="0" class="menu-btn flex items-center space-x-1">
								<svg class="w-5 h-5" fill="none" stroke="currentColor">
									<use href="#heroicon-o-eye"></use>
								</svg>
								<span>View</span>
							</label>
							<ul
								tabindex="0"
								class="dropdown-content menu p-2 shadow bg-gray-800 rounded-box w-52"
							>
								<li><a @click="toggleGrid">Toggle Grid</a></li>
								<li><a @click="toggleAxes">Toggle Axes</a></li>
							</ul>
						</div>
						<!-- Camera Dropdown -->
						<div class="dropdown dropdown-hover">
							<label tabindex="0" class="menu-btn flex items-center space-x-1">
								<svg class="w-5 h-5" fill="none" stroke="currentColor">
									<use href="#heroicon-o-camera"></use>
								</svg>
								<span>Camera</span>
							</label>
							<ul
								tabindex="0"
								class="dropdown-content menu p-2 shadow bg-gray-800 rounded-box w-52"
							>
								<li><a @click="resetCamera">Reset Camera</a></li>
								<li><a @click="switchToPerspective">Perspective View</a></li>
								<li><a @click="switchToOrthographic">Orthographic View</a></li>
							</ul>
						</div>
					</div>
					<!-- Right Side Buttons -->
					<div class="flex items-center space-x-2">
						<button class="menu-btn" @click="toggleFullScreen">
							<svg class="w-5 h-5" fill="none" stroke="currentColor">
								<use href="#heroicon-o-arrows-expand"></use>
							</svg>
						</button>
						<button class="menu-btn" @click="takeScreenshot">
							<svg class="w-5 h-5" fill="none" stroke="currentColor">
								<use href="#heroicon-o-photograph"></use>
							</svg>
						</button>
					</div>
				</div>

				<!-- Status Cards -->
				<div class="absolute bottom-4 left-4 flex space-x-4">
					<div class="status-card flex flex-col text-white text-sm">
						<span class="font-semibold">Coordinates</span>
						<span id="coordinates">
							X: <span x-text="cameraPosition.x">0.00</span>, Y:
							<span x-text="cameraPosition.y">0.00</span>, Z:
							<span x-text="cameraPosition.z">0.00</span>
						</span>
					</div>
					<!-- Add more status cards if needed -->
				</div>
			</div>
		</div>

		<!-- Script -->
		<script>
			function rendererUI() {
				return {
					renderer: null,
					cameraPosition: { x: 0.0, y: 0.0, z: 0.0 },
					init() {
						// Wait for the renderer to be initialized
						document
							.getElementById("canvas")
							.addEventListener("rendererInitialized", () => {
								console.log("Renderer initialized");
								this.renderer =
									document.getElementById("canvas").schematicRenderer;

								// Ensure the renderer is initialized
								if (!this.renderer) {
									console.warn(
										"Renderer not initialized attempting to retrieve"
									);
									return;
								}

								// Listen for camera position changes
								const updateCameraPosition = (event) => {
									if (event.property === "position") {
										this.cameraPosition = {
											x: event.value.x.toFixed(2),
											y: event.value.y.toFixed(2),
											z: event.value.z.toFixed(2),
										};
									}
								};

								this.renderer.cameraManager.on(
									"propertyChanged",
									updateCameraPosition
								);

								// Initialize with current camera position
								const initialPosition = this.renderer.cameraManager.position;
								this.cameraPosition = {
									x: initialPosition.x.toFixed(2),
									y: initialPosition.y.toFixed(2),
									z: initialPosition.z.toFixed(2),
								};
							});
					},
					toggleGrid() {
						if (!this.renderer) {
							console.warn("Renderer not initialized");
							return;
						}
						this.renderer.sceneManager.showGrid =
							!this.renderer.sceneManager.showGrid;
					},
					toggleAxes() {
						if (!this.renderer) {
							console.warn("Renderer not initialized");
							return;
						}
						this.renderer.sceneManager.showAxes =
							!this.renderer.sceneManager.showAxes;
					},
					resetCamera() {
						if (!this.renderer) {
							console.warn("Renderer not initialized");
							return;
						}
						// Reset camera position and rotation
						this.renderer.cameraManager.position = [0, 0, 5];
						this.renderer.cameraManager.rotation = [0, 0, 0];
					},
					switchToPerspective() {
						if (!this.renderer) {
							console.warn("Renderer not initialized");
							return;
						}
						this.renderer.cameraManager.switchCamera("perspective");
					},
					switchToOrthographic() {
						if (!this.renderer) {
							console.warn("Renderer not initialized");
							return;
						}
						this.renderer.cameraManager.switchCamera("orthographic");
					},
					toggleFullScreen() {
						const elem = document.documentElement;
						if (!document.fullscreenElement) {
							elem.requestFullscreen().catch((err) => {
								alert(
									`Error attempting to enable full-screen mode: ${err.message} (${err.name})`
								);
							});
						} else {
							document.exitFullscreen();
						}
					},
					takeScreenshot() {
						if (!this.renderer) {
							console.warn("Renderer not initialized");
							return;
						}
						// Example screenshot functionality
						const dataURL =
							this.renderer.renderManager.renderer.domElement.toDataURL(
								"image/png"
							);
						const link = document.createElement("a");
						link.href = dataURL;
						link.download = "screenshot.png";
						link.click();
					},
				};
			}
		</script>

		<!-- Include your main.js or main.ts script that initializes the SchematicRenderer -->
		<script type="module" src="./main.js"></script>
	</body>
</html>
